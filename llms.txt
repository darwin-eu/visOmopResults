# visOmopResults

## Package overview

**visOmopResults** offers a set of functions tailored to format objects
of class `<summarised_result>` (as defined in
[omopgenerics](https://darwin-eu.github.io/omopgenerics/articles/summarised_result.html)
package).

It provides functionalities to create formatted **tables** and generate
**plots**. These visualisations are highly versatile for reporting
results through Shiny apps, RMarkdown, Quarto, and more, supporting
various output formats such as HTML, PNG, Word, and PDF.

## Let’s get started

You can install the latest version of **visOmopResults** from CRAN:

``` r
install.packages("visOmopResults")
```

Or you can install the development version from
[GitHub](https://github.com/darwin-eu/visOmopResults) with:

``` r
# install.packages("pak")
pak::pkg_install("darwin-eu/visOmopResults")
```

The `<summarised_result>` is a standardised output format utilized
across various packages, including:

- [CohortCharacteristics](https://cran.r-project.org/package=CohortCharacteristics)
- [DrugUtilisation](https://cran.r-project.org/package=DrugUtilisation)
- [IncidencePrevalence](https://cran.r-project.org/package=IncidencePrevalence)
- [PatientProfiles](https://cran.r-project.org/package=PatientProfiles)
- [CodelistGenerator](https://cran.r-project.org/package=CodelistGenerator)
- [CohortSurvival](https://cran.r-project.org/package=CohortSurvival)
- [CohortSymmetry](https://cran.r-project.org/package=CohortSymmetry)

Although this standard output format is essential, it can sometimes be
challenging to manage. The **visOmopResults** package aims to simplify
this process. To demonstrate the package’s functionality, let’s start by
using some mock results:

``` r
library(visOmopResults)
result <- mockSummarisedResult()
```

## Tables visualisations

Currently all table functionalities are built around 4 packages:
[tibble](https://cran.r-project.org/package=tibble),
[gt](https://cran.r-project.org/package=gt),
[flextable](https://cran.r-project.org/package=flextable), and
[datatable](https://CRAN.R-project.org/package=DT).

There are two main functions:

- [`visOmopTable()`](https://darwin-eu.github.io/visOmopResults/reference/visOmopTable.md):
  Creates a well-formatted table specifically from a
  `<summarised_result>` object.
- [`visTable()`](https://darwin-eu.github.io/visOmopResults/reference/visTable.md):
  Creates a nicely formatted table from any `<data.frame>` object.

Let’s see a simple example:

``` r
result |>
  filterStrata(sex != "overall" & age_group != "overall") |>
  visOmopTable(
    type = "flextable",
    estimateName = c(
      "N(%)" = "<count> (<percentage>%)", 
      "N" = "<count>", 
      "mean (sd)" = "<mean> (<sd>)"),
    header = c("sex", "age_group"),
    settingsColumn = NULL,
    groupColumn = c("cohort_name"),
    rename = c("Variable" = "variable_name", " " = "variable_level"),
    hide = "cdm_name",
    style = "darwin"
  )
```

![](reference/figures/README-unnamed-chunk-5-1.png)

## Plots visualisations

Currently all plot functionalities are built around
[ggplot2](https://cran.r-project.org/package=ggplot2). The output of
these plot functions is a `<ggplot2>` object that can be further
customised.

There are three plotting functions:

- `plotScatter()` to create a scatter plot.
- `plotBar()` to create a bar plot.
- `plotBox()` to create a box plot.

Additionally, the
[`themeVisOmop()`](https://darwin-eu.github.io/visOmopResults/reference/themeVisOmop.md)
function applies a consistent styling to the plots, aligning them with
the package’s visual design.

Let’s see how we can create a simple boxplot for age:

``` r
library(dplyr)
result |>
  filter(variable_name == "number subjects") |>
  filterStrata(sex != "overall") |>
  barPlot(
    x = "age_group", 
    y = "count",
    facet = "cohort_name", 
    colour = "sex",
    style = "darwin"
  )
```

![](reference/figures/README-unnamed-chunk-6-1.png)

# Package index

## Table functions

### Main functions

- [`visOmopTable()`](https://darwin-eu.github.io/visOmopResults/reference/visOmopTable.md)
  :

  Generate a formatted table from a `<summarised_result>`

- [`visTable()`](https://darwin-eu.github.io/visOmopResults/reference/visTable.md)
  :

  Generate a formatted table from a `<data.table>`

### Additional table formating functions

- [`formatEstimateName()`](https://darwin-eu.github.io/visOmopResults/reference/formatEstimateName.md)
  : Formats estimate_name and estimate_value column
- [`formatEstimateValue()`](https://darwin-eu.github.io/visOmopResults/reference/formatEstimateValue.md)
  : Formats the estimate_value column
- [`formatHeader()`](https://darwin-eu.github.io/visOmopResults/reference/formatHeader.md)
  : Create a header for gt and flextable objects
- [`formatMinCellCount()`](https://darwin-eu.github.io/visOmopResults/reference/formatMinCellCount.md)
  : To indicate which was the minimum cell counts where estimates have
  been suppressed.
- [`formatTable()`](https://darwin-eu.github.io/visOmopResults/reference/formatTable.md)
  : Creates a flextable or gt object from a dataframe

### Helper table functions

- [`emptyTable()`](https://darwin-eu.github.io/visOmopResults/reference/emptyTable.md)
  : Returns an empty table

- [`setGlobalTableOptions()`](https://darwin-eu.github.io/visOmopResults/reference/setGlobalTableOptions.md)
  : Set format options for all subsequent tables

- [`tableColumns()`](https://darwin-eu.github.io/visOmopResults/reference/tableColumns.md)
  : Columns for the table functions

- [`tableOptions()`](https://darwin-eu.github.io/visOmopResults/reference/tableOptions.md)
  :

  Additional table formatting options for
  [`visOmopTable()`](https://darwin-eu.github.io/visOmopResults/reference/visOmopTable.md)
  and
  [`visTable()`](https://darwin-eu.github.io/visOmopResults/reference/visTable.md)

- [`tableStyle()`](https://darwin-eu.github.io/visOmopResults/reference/tableStyle.md)
  : Pre-defined styles are available for tables

- [`tableType()`](https://darwin-eu.github.io/visOmopResults/reference/tableType.md)
  : Supported table classes

## Plot functions

- [`barPlot()`](https://darwin-eu.github.io/visOmopResults/reference/barPlot.md)
  :

  Create a bar plot visualisation from a `<summarised_result>` object

- [`boxPlot()`](https://darwin-eu.github.io/visOmopResults/reference/boxPlot.md)
  :

  Create a box plot visualisation from a `<summarised_result>` object

- [`emptyPlot()`](https://darwin-eu.github.io/visOmopResults/reference/emptyPlot.md)
  : Returns an empty plot

- [`scatterPlot()`](https://darwin-eu.github.io/visOmopResults/reference/scatterPlot.md)
  :

  Create a scatter plot visualisation from a `<summarised_result>`
  object

### Helper plot functions

- [`plotColumns()`](https://darwin-eu.github.io/visOmopResults/reference/plotColumns.md)
  : Columns for the plot functions
- [`plotStyle()`](https://darwin-eu.github.io/visOmopResults/reference/plotStyle.md)
  : Pre-defined styles are available for plots
- [`plotType()`](https://darwin-eu.github.io/visOmopResults/reference/plotType.md)
  : Supported plot types
- [`setGlobalPlotOptions()`](https://darwin-eu.github.io/visOmopResults/reference/setGlobalPlotOptions.md)
  : Set format options for all subsequent plots
- [`themeVisOmop()`](https://darwin-eu.github.io/visOmopResults/reference/themeVisOmop.md)
  : Apply a pre-defined visOmopResults theme to a ggplot

## Other functionalities

### To style text

- [`customiseText()`](https://darwin-eu.github.io/visOmopResults/reference/customiseText.md)
  : Apply styling to text or column names

### To get extra fonts

### Mock `<summarised_result>`

- [`data`](https://darwin-eu.github.io/visOmopResults/reference/data.md)
  : List of mock results

- [`mockSummarisedResult()`](https://darwin-eu.github.io/visOmopResults/reference/mockSummarisedResult.md)
  :

  A `<summarised_result>` object filled with mock data

# Articles

### All vignettes

- [Tables](https://darwin-eu.github.io/visOmopResults/articles/a01_tables.md):
- [Plots](https://darwin-eu.github.io/visOmopResults/articles/a02_plots.md):
- [Quarto
  reports](https://darwin-eu.github.io/visOmopResults/articles/a03_quarto_reports.md):
- [Shiny
  Apps](https://darwin-eu.github.io/visOmopResults/articles/a04_shiny_apps.md):
- [Styles](https://darwin-eu.github.io/visOmopResults/articles/a05_style.md):
